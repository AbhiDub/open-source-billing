<div class="new-invoice-holder editInvoice">
  <%- model_class = Estimate -%>
  <%= nested_form_for estimate, :html => {:class => 'estimate-form form-horizontal', :novalidate => ""} do |f| %>
      <div class="new-invoice-header clearfix">
        <h5 class="left">
          <% if f.object.persisted? %>
              <%= t '.title', :default => t('helpers.titles.edit', :model => model_class.model_name.human,
                                            :default => "Edit #{model_class.model_name.human}") %>:
          <% else %>
              <%= t '.title', :default => t('helpers.titles.new', :model => model_class.model_name.human,
                                            :default => "New  #{model_class.model_name.human}") %>:
          <% end %>
          <% selected_client = @client.present? ? @client.id : f.object.client_id %>
          <%= f.select :client_id, options_for_select(load_clients(action_name, estimate.company_id), selected: selected_client),  {prompt: "Select Client", include_blank: false}  %>
        </h5>
        <div class="new-invoice-action-btn right">
          <a href="#" onclick="$('.simple_submit').click();" title="Send"><i class="material-icons">send</i></a>
          <a href="#" onclick="$('.send_submit').click();" title="Save"> <i class="material-icons" >done</i></a>
          <%= link_to raw("<i class='material-icons close'>close</i>"), estimates_url %>
          <% button_text = action_name == "new" ? t('views.common.save_as_draft') : t('views.common.save') %>
          <%= f.submit raw("<i class='material-icons' >done</i>"), :class => 'simple_submit submit hidden' %>
          <%= f.submit "#{button_text}", :class => 'send_submit submit hidden', :name => 'save_as_draft' %>

        </div>
      </div>
      <div class="scroll-area mCustomScrollbar">
        <div class="info-section clearfix">
          <div class="info-left-section">
            <h6><%= estimate.estimate_number %></h6>
            <span>Estimate: <small id="estimate_date"> <%= default_date f.object.estimate_date.to_date %></small> <i class="material-icons" id="estimate_date_picker">date_range</i></span>
            <%= f.hidden_field :estimate_date,value: f.object.estimate_date, :required => "" %>
            <div class="paymentInfo">
              <strong><strong class="estimate_total_strong"></strong>
                <small>
                  <% selected_currency = (@client.present? ? @client.currency_id : f.object.currency_id) %>
                  <%= f.select :currency_id, options_for_select(Currency.all.collect{|c| ["#{c.unit}",c.id] }, selected: selected_currency),  {include_blank: false}, {class: 'inline-select large-select'} %>
                </small>
              </strong>
            </div>
          </div>

        </div>
        <div class="new-invoice-table-holder main-invoice">
          <table class="bordered responsive-table estimate_grid_fields" id="estimate_grid_fields">
            <thead>
            <tr>
              <th>&nbsp;</th>
              <th width="12%">Items</th>
              <th>Description</th>
              <th class="center-align">Unit Cost</th>
              <th class="center-align">Quantity</th>
              <th class="center-align">Tax</th>
              <th class="right-align">Line Total</th>
            </tr>
            </thead>
            <tbody id="estimate_line_items_tbl">
            <%= f.fields_for :estimate_line_items, :wrapper => false %>
            </tbody>
          </table>
        </div>
        <div class="new-invoice-footer">
          <%= f.link_to_add t("views.estimates.add_line_item"), :estimate_line_items, class: 'invoice-add-items-button addItemRow', id: 'add_line_item', data: { target: '#estimate_line_items_tbl' } %>
          <div class="right-section right">
            <div class="invoice-total-left">
              <strong class="invoice-total-title">Subtotal</strong>
              <div class="new-invoice-footer-row">
                <span>Discount</span>
                <%= f.select :discount_type, @discount_types, { selected: f.object.discount_type } , {:class => "discount_select inline-select small-select", :id => "discount_type"} %>
              </div>
              <strong class="invoice-total-title bottom">New Total</strong>
            </div>
            <div class="invoice-total-right">
              <%= f.hidden_field :sub_total %>
              <strong class="invoice-total-title"><%= estimate.currency.unit rescue 'USD' %> <span><%= label_tag '', '', :id => 'estimate_sub_total_lbl' %></span></strong>
              <div class="new-invoice-footer-row">
                <span><%= estimate.currency.unit rescue 'USD' %></span>
                <%= f.hidden_field :discount_amount %>
                <%= f.number_field :discount_percentage, class: "input-inoive-number invoice_discount line_item_qtip right-align", placeholder:  "00.00", min: 0 %>
                <%= label_tag '', '', :id => 'estimate_discount_amount_lbl', :style => 'font-weight:normal; display:none;' %>
              </div>
              <%= f.hidden_field :estimate_total %>
              <strong class="invoice-total-title bottom"><%= estimate.currency.unit rescue 'USD' %> <span><%= label_tag '', '0', :id => 'estimate_total_lbl', :class => 'net_total_value' %></span></strong>
            </div>

          </div>
        </div>
        <div class="invoice-add-notes">
          <a href="#"><i class="material-icons">chat</i> </a>
          <div class="invoice-add-notes-textare">
            <%= f.text_area :notes, maxlength: 400, placeholder: 'Add Notes'%>
          </div>
        </div>
      </div>
  <% end %>
</div>

<script>
    $(document).ready(function (){
        Estimate.change_estimate_item();
        Estimate.changeTax();
        Estimate.load_functions();
    });
</script>