<div class="col s12 page-box-header">
  <div class="title-desc">
    <h6><%= t('views.common.' + @report.client_name.parameterize.underscore) %></h6>
    <span class="text-uppercase"><%= raw @report.period %></span>
  </div>
  <p><%= t('views.reports.payments_collected_dtl') %></p>

  <%= render 'reports/report_partials/format_links'%>
</div>
<br/>
<table class="bordered">
    <thead>
    <tr>
      <th width="15%"><%= t('views.clients.client_name') %></th>
      <th width="10%"><%= t('views.invoices.invoice') %></th>
      <th width="15%"><%= t('views.common.type') %></th>
      <th  width="30%"><%= t('views.common.note') %></th>
      <th class="center-align" width="10%"><%= t('views.common.date') %></th>
      <th class="right-align {sorter:'thousands'}" width="20%"><%= t('views.dashboard.amount') %></th>
    </tr>
    </thead>
    <% unless @report.report_data.blank? %>
      <tbody>
        <% @report.report_data.group_by{|data| data[:client_name]}.values.each do |payments| %>
          <tr>
            <td class="align_left text-overflow-class" data-overflow-rows="2" ><%= payments.first[:client_name] %></td>
            <td class="align_left" >
              <% payments.each do |payment| %>
                <%= request.format.pdf? ? payment.invoice.invoice_number : (link_to payment.invoice.invoice_number, invoice_path(payment.invoice),remote: true) %>
                <br>
              <% end %>
            </td>
            <td class="align_left" >
              <% payments.each do |payment| %>
                <%= (payment.payment_type || payment.payment_method || "").capitalize %>
                <br>
              <% end %>
            </td>
            <td class="left-align text-overflow-class" data-overflow-rows="2" >
              <% payments.each do |payment| %>
                <%= payment.notes %>
                <br>
              <% end %>
            </td>
            <td class="center-align" >
              <% payments.each do |payment| %>
                <%= payment.created_at.to_date.strftime(get_date_format) %>
                <br>
              <% end %>
            </td>
            <td class="right-align currency" >
              <% payments.each do |payment| %>
                <%= content_tag(:span, '* ') if payment.payment_method == "Credit" %>
                  <%= payment.currency_code %>
                  <%= number_to_currency(payment.payment_amount,unit: '') %>
                <br>
              <% end %>
            </td>
          </tr>
       <% end %>
      </tbody>
    <tfoot>
      <tr>
        <td colspan="5"><strong><%= t('views.common.total') %></strong></td>
        <td class="right-align currency">
          <% @report.report_total.each do |total| %>
            <span>
              <b>
                <%= total[:currency_code] %>
                <%= number_to_currency(total[:total],unit: '') %>
              </b>
            </span>
          <% end %>
        </td>
      </tr>
    </tfoot>
<% else %>
      <tbody>
      <tr>
        <td colspan="6"><%= t('views.reports.report_no_data') %></td>
      </tr>
      </tbody>
<% end %>
</table>
